<% breadcrumb :application_qualifications, @school %>
<% @title = 'Qualifications' %>

<%= render partial: 'remove_modal',
           locals: {title: 'Remove Qualification',
                    message: 'Are you sure you want to remove the following qualification?'} %>

<div class="row">
  <div class="col-sm-3">
    <%= render partial: 'stages_sidebar', locals: {application: @school.application, stage: :education_stage} %>
  </div>

  <div class="col-sm-9">
    <%= form_for @qualification, :html => {:class => 'form-horizontal', :role => 'form' }, url: applications_qualifications_add_path(@school), method: :post do |f| %>
      <div class="row">
        <div class="col-xs-10">
          <h3 class="no-top-margin">Add Qualifications</h3>
        </div>
        <div class="col-xs-2 text-darkish small text-right">
          <em>* Optional</em>
        </div>
      </div>

      <p class="text-darkish small">Add the qualifications you gained at <%= @school.name %>. If you have not completed
        your studies, enter the future end date and predicated grade.</p>
      <%= form_errors @qualification %>

      <div class="row">
        <div class="col-sm-6 col-xs-12">
          <%= form_text_field f, :subject %>
          <%= form_text_field f, :award %>
          <%= form_text_field f, :grade, {label: '* Grade'} %>
        </div>

        <div class="col-sm-6 col-xs-12">
          <%= form_date f, :start_date %>
          <%= form_date f, :end_date %>
        </div>
      </div>

      <div class="text-right">
        <%= f.submit 'Add Qualification', class: 'add-button' %>
      </div>
    <% end %>

    <hr>
    <h3 class="no-top-margin">
      Qualifications
      <% count = @school.qualifications.size%>
      <%= "(#{count})" if count > 0 %>
    </h3>

    <% if count == 0 %>
      <p class="text-darkish small"><em>Any qualifications you add will appear here.</em></p>
    <% else %>
      <p class="text-darkish small">You can remove a qualification by clicking the remove button.</p>
      <div class="list-group">
        <% @school.qualifications.order(end_date: :desc).each do |qualification| %>
          <div class="list-group-item well">
            <div class="row">
              <div class="col-sm-6">
                <h4 class="no-top-margin"><%= qualification.subject %></h4>
                <ul class="list-unstyled small">
                  <li>Award: <%= qualification.award %></li>
                  <li>Grade: <%= qualification.grade %></li>
                  <li>Start: <%= format_date qualification.start_date %> &mdash; <%= format_date qualification.end_date %></li>
                </ul>
              </div>

              <div class="col-sm-6 text-right">
                <a class="add-button custom-modal-button"
                   role="button"
                   data-modal-name="<%= qualification.subject %> - <%= qualification.award %>"
                   data-modal-path="<%= applications_qualifications_remove_path(qualification) %>">
                  <%= icon 'trash', style: 'font-size: 13pt;' %>
                  &nbsp;
                  Remove
                </a>
              </div>
            </div>
          </div>
        <% end %> <!-- loop -->
      </div>
    <% end %> <!-- if -->

    <p><%= link_to 'Go back...', applications_education_path %></p>

  </div>
</div>
